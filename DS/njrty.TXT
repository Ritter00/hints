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
hJfy7mJ8bUraQWx - aleh.zimnokha@aimtalk.me
admin3@admin.admin - vber#%TverASF6
admin1@admin.admin - BOUN234trASD786
https://habr.com/ru/post/341704/
https://vh82.hoster.by:2083/ - хостинг
visemby
Aesae1ia
https://dev.visem.by/admin/
login: admin
pass: viSem!2022

https://my.deliverysolution.site/login
mmolokovskikh@gmail.com
g75btyf6uz

sudo ssh -i "kk/ds_prod" ubuntu@51.250.92.135		#ru
ssh -i "kk/ds_prod" root@165.227.155.121		#site
/home/ritter00/kk
git pull
delivery
docker-compose down
docker-compose -f docker-compose.yadcloud.yml build
docker-compose -f docker-compose.yadcloud.yml up

docker-compose down -v	# сбросить миграции
docker-compose build
docker-compose up
docker-compose exec web python manage.py makemigrations		# во втором терминале
docker-compose exec web python manage.py migrate

docker exec -it 16f67df7da20 /bin/bash	# доступ в контейнер
chmod o+xrw $(find *.jpg)		# найти и назначить права

docker-compose up --force-recreate
docker-compose exec web python manage.py shell
from accounts.models import Account
Account.objects.all()

sudo chmod 777 db_django	#права удалить папку
sudo rm -r db_django/
sudo chown -R ritter00:ritter00 db_django/

docker stop $(docker ps -a -q)
docker rm $(docker ps -a -q)
docker system prune --volumes	#очистить образы

------дамп с сервера на локалку висем-----------------
source /home/visemby/virtualenv/dev.visem.by/3.8/bin/activate && cd /home/visemby/dev.visem.by			#виртульное окр на сервере
mysqldump --no-tablespaces -u visemby_visem_dev --password=visem_a1zahOeR9kcef visemby_dev > dump31_10_22.sql   # сделать дамп БД на дев-висем
														#скачать и загрузить в корень проекта
sudo rm -r db_django/												#удалить БД
docker system prune --volumes											#очистить образы чистит все
docker-compose up --build											#заново собрать 
docker-compose exec web python manage.py makemigrations		# во втором терминале
docker-compose exec web python manage.py migrate
cat dump31_10_22.sql | docker exec -i b367287b312f /usr/bin/mysql -u root --password=password db_django		#загрузить бд(номер контейнера взять свой - b367287b312f)
-----------------------------------------------------------

cat dump07_06_22.sql | docker exec -i 945cb1dc8ecc /usr/bin/mysql -u root --password=password db_django 	# загрузить дамп памяти backup.sql
cat dump31_10_22.sql | docker exec -i b367287b312f /usr/bin/mysql -u root --password=password db_django
docker exec 0d5a544509f7 /usr/bin/mysqldump -u root --password=password db_django > backup_10_may_2022.sql		# перезаписать дамп памяти backup.sql
docker exec 1c4bba058f81 /usr/bin/mysqldump -u root --password=password db_django > backup_6_june_2022_adr.sql

cat dump_migrator_10.july.2022.sql | docker exec -i 1fdf480233db psql --username delivery delivery_db	#DS
docker exec -i 1fdf480233db psql --username delivery delivery_db < dump_migrator_10.july.2022.sql
docker exec -it 4540739de5b0 dropdb delivery_db -U delivery						#KILL db DS

mysqldump --no-tablespaces -u visemby_visem_dev --password=visem_a1zahOeR9kcef visemby_dev > dump31_10_22.sql  # сделать дамп БД на дев-висем

send_mail('subject', 'body of the message', 'postmaster@mail.deliverysolution.site', ['django.test.ds.183@gmail.co'])
________________________________________________
docker-compose exec web python manage.py shell

---Деплой Висем------------------------------------serve
source /home/visemby/virtualenv/dev.visem.by/3.8/bin/activate && cd /home/visemby/dev.visem.by	#виртульное окр
git pull origin dev
ssh password на хостинге - visem
python manage.py migrate
pip install -r requirements.txt
затем перезагружаешь приложение и обнуляешь passenger
git restore passenger_wsgi.py
---------------------------CI/CD--------------------------------------
https://medium.com/swlh/how-to-deploy-your-application-to-digital-ocean-using-github-actions-and-save-up-on-ci-cd-costs-74b7315facc2
------------------------deploy delivery.site--------------------------------------
cd ../usr/src/delivery-solution
git pull git@github.com:DeliverySolution/delivery-solution.git
docker-compose -f docker-compose.prod.yml down
docker-compose -f docker-compose.prod.yml up --build -d 
docker-compose -f docker-compose.prod.yml exec web python manage.py migrate &&
docker-compose -f docker-compose.prod.yml exec web python manage.py collectstatic --no-input --clear
docker system prune -a
-----------------обновить сертификат dev.delivery------------------------------
cd ../usr/src/delivery-solution
docker-compose -f docker-compose.prod.yml down								#остановить сервер, порт 80 д.б. свободен
certbot certonly -d dev.deliverysolution.site								#(sudo) обновить сертификат для dev.deliverysolution.site
Выберите Spin up a temporary webserver (standalone) (введите 1).					#поднять временный сервер для проверки
Выберите Renew & replace the cert (limit ~5 per 7 days) (введите 2).
docker-compose -f docker-compose.prod.yml up --build -d 						#запкстить контейнеры 
https://trueconf.ru/blog/baza-znaniy/sozdanie-sertifikata-lets-encrypt-na-linux.html			#получить и обновить сертификат на сервере
https://pentacent.medium.com/nginx-and-lets-encrypt-with-docker-in-less-than-5-minutes-b4b8a60d3a71  	#docker-nginx-certbot
___________________________________________________
https://habr.com/ru/post/579336/ спарсить любой сайт

------------------залить бд деливери-------------------------------
удалить контейнер с бд
docker volume rm delivery-solution_postgres_data 			#удалить том с БД
docker-compose build
docker-compose up
cat dump_migrator_10.july.2022.sql | docker exec -i 1fdf480233db psql --username delivery delivery_db	#залить базу
docker-compose exec web python manage.py makemigrations		
docker-compose exec web python manage.py migrate

cat bsckup.sql | docker exec -it pg_container -U delivery -d delivery_db
docker exec -it 4540739de5b0 dropdb delivery_db -U delivery
postgresql
sudo systemctl stop postgresql
-с "CREATE DATABASE delivery_db;"
docker exec -it 4540739de5b0 psql -U delivery -c "CREATE DATABASE delivery_db;"
-----------------------------------------------------------